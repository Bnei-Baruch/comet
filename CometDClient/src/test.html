<!-- 1The following line is essential for the "position: fixed" property to work correctly in IE -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>jquery.ui.chatbox</title>
    <link rel="stylesheet" href="../scripts/css/smoothness/jquery-ui-1.8.10.custom.css" type="text/css" media="screen" />
    <script type="text/javascript" src="../scripts/jquery/jquery-1.4.3.js"></script>
    <script type="text/javascript" src="../scripts/jquery/jquery-ui-1.8.10.custom.min.js"></script>
    <link type="text/css" href="../scripts/chatbox/jquery.ui.chatbox.css" rel="stylesheet" />
    <script type="text/javascript" src="../scripts/chatbox/jquery.ui.chatbox.js"></script>
    <script type="text/javascript" src="../scripts/chatbox/chatboxManager.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
          var box = null;
          $("input[type='button']").click(function(event, ui) {
              if(box) {
                  box.chatbox("option", "boxManager").toggleBox();
              }
              else {
                  box = $("#chat_div").chatbox({id:"chat_div", 
                                                user:{key : "value"},
                                                title : "test chat",
                                                messageSent : function(id, user, msg) {
                                                    $("#log").append(id + " said: " + msg + "<br/>");
                                                    $("#chat_div").chatbox("option", "boxManager").addMsg(id, msg);
                                                }});
              }
          });
      });
    </script>

	<script type="text/javascript" src="../scripts/jquery/json2.js"></script>
	<script type="text/javascript" src="../scripts/org/cometd-namespace.js"></script>
	<script type="text/javascript" src="../scripts/org/cometd-json.js"></script>
	<script type="text/javascript" src="../scripts/org/TransportRegistry.js"></script>
	<script type="text/javascript" src="../scripts/org/WebSocketTransport.js"></script>
	<script type="text/javascript" src="../scripts/org/Transport.js"></script>
	<script type="text/javascript" src="../scripts/org/LongPollingTransport.js"></script>
	<script type="text/javascript" src="../scripts/org/RequestTransport.js"></script>
	<script type="text/javascript" src="../scripts/org/CallbackPollingTransport.js"></script>
	<script type="text/javascript" src="../scripts/org/Utils.js"></script>
	<script type="text/javascript" src="../scripts/org/Cometd.js"></script>
	<script type="text/javascript" src="../scripts/org/cometd/AckExtension.js"></script>
	<script type="text/javascript" src="../scripts/org/cometd/ReloadExtension.js"></script>
	<script type="text/javascript" src="../scripts/jquery/jquery.kookie.js"></script>
	<script type="text/javascript" src="../scripts/jquery/jquery.cometd.js"></script>
	<script type="text/javascript" src="../scripts/jquery/jquery.cometd-reload.js"></script>
    <script type="text/javascript" src="../scripts/app.js"></script>
    
	<script type="text/javascript"> 
      $(document).ready(function(){

	  var a_channel = "/auth/demo";

	  var contextPath = "localhost:8080"; // CometD server path or ip
	  var applicationId ="1234"; // String identifying the application id, base channel
	  var username = "Hello World"; // For authenticated applications only, if null no authentication
      var verify = "ac5c3404f57a5061f36a694eb5d56214"; // For authenticated applications only, if null no authentication

	  var connectionEstablished = function() { 
	  		  app.subscribe(a_channel, receiveMessage); 
	  }; // hook for event, may be null
	  var connectionBroken = function() { alert("connectionBroken"); }; // hook for event, may be null
	  var connectionClosed = function() { alert("connectionClosed"); }; // hook for event, may be null
	    
	  var app = new $.App(
	   	contextPath,
	   	applicationId,
	   	username,
	   	verify,
	   	connectionEstablished,
	   	connectionBroken,
	   	connectionClosed
	  );
	    	
	  app.connect();
 
      var counter = 0;
      var idList = new Array();
 
 	  var sendMessage = function(from, msg) {
 	  	app.publish(a_channel, {"from":from, "msg":msg})
 	  }

 	  var receiveMessage = function(message) {
 	  	var from = message.data["from"];
 	  	var msg = message.data["msg"];
 	  	
        for(var i = 0; i < idList.length; i ++) {
          chatboxManager.addBox(idList[i]);
          $("#" + idList[i]).chatbox("option", "boxManager").addMsg(from, msg);
        }
 	  }
 
      var broadcastMessageCallback = function(from, msg) {
          for(var i = 0; i < idList.length; i ++) {
              chatboxManager.addBox(idList[i]);
              $("#" + idList[i]).chatbox("option", "boxManager").addMsg(from, msg);
          }
          alert("this is without push");
      }
 
      // chatboxManager is excerpt from the original project
      // the code is not very clean, I just want to reuse it to manage multiple chatboxes
      chatboxManager.init({messageSent : sendMessage,
						   pushApp : app});
 
      $("#link_add").click(function(event, ui) {
          counter ++;
          var id = "box" + counter;
          idList.push(id);
          chatboxManager.addBox(id, 
                                  {dest:"dest" + counter, // not used in demo
                                   title:"box" + counter,
                                   first_name:"First" + counter,
                                   last_name:"Last" + counter
                                   //you can add your own options too
                                  });
          event.preventDefault();
      });
 
      });
    </script> 
    
  </head>
  <body>
    <p>It will not work untill necessary scripts and stylesheets are
    properly loaded, check out the code.</p>  <input type="button"
    name="toggle" value="toggle" />
    <div dir="rtl" id="chat_div">
    </div>
    <hr />
    <div id="log">
    </div>
    <p><a id="link_add" href="#">Add Chatbox</a></p>
  </body>
</html>
